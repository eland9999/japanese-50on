<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>日英雙語互動學習</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --jp-main: #ed2939;
      --en-main: #2257c2;
      --accent: #1f2937;
      --bg: #f6f7fb;
      --card: #fff;
      --shadow: 0 4px 16px rgba(0,0,0,0.06);
      --radius: 16px;
    }
    * { box-sizing: border-box; margin:0; padding:0 }
    body { font-family:'Noto Sans JP','Roboto',sans-serif; background:var(--bg); }
    header { text-align:center; padding:20px 0; }
    header h1 { font-size:2em; color:var(--accent); }
    #langSwitch { text-align:center; margin-bottom:16px; }
    #langSwitch button {
      margin:0 8px; padding:8px 16px; border:none; border-radius:8px;
      background:var(--accent); color:#fff; font-weight:700; cursor:pointer;
      transition: background .2s;
    }
    #langSwitch button.active { background:var(--jp-main); }
    section { display:none; padding:0 12px; }
    section.active { display:block; }
    .controls { text-align:center; margin:16px 0; }
    .controls button {
      margin:4px; padding:8px 14px; border:none; border-radius:10px;
      background:var(--accent); color:#fff; cursor:pointer; font-weight:700;
      transition: background .2s;
    }
    .controls button:hover { background:var(--jp-main); }
    .card { background:var(--card); border-radius:var(--radius);
      box-shadow:var(--shadow); max-width:960px; margin:0 auto 24px; padding:24px;
    }
    /* Japanese quiz */
    .row { display:flex; flex-wrap:wrap; gap:12px; }
    .question {
      flex:1 1 80px; background:#fafafd; border:1.2px solid #e2e4e8;
      border-radius:10px; padding:12px; text-align:center;
    }
    .question label { font-size:1.4em; color:var(--jp-main); font-weight:700; }
    .question input { width:100%; padding:4px; margin-top:4px; }
    .feedback { display:block; margin-top:4px; font-weight:700; }
    .correct { color:green; }
    .incorrect { color:red; }
    /* English quiz */
    .word-item { display:flex; align-items:center; padding:6px 0; border-bottom:1px solid #eee; }
    .word-index { color:var(--en-main); width:2em; text-align:right; font-weight:700; }
    .word-meaning { flex:0 0 120px; }
    .word-src { margin-left:12px; color:#b85728; font-size:.9em; }
    .word-link a { margin-left:8px; text-decoration:underline; font-size:.9em; color:#e54848; }
    .ans-input { width:100px; padding:4px; margin:0 8px; }
    .ans-feedback { min-width:60px; font-weight:700; }
    .syns { color:#997820; font-size:.9em; margin-left:8px; }
    button { margin:24px auto 0 auto; display:block; background:var(--en-main); color:#fff;
      border:none; border-radius:9px; padding:10px 28px; font-weight:700; cursor:pointer;
    }
    button:hover { background:#e54848; }
    @media (max-width:600px) {
      .question { flex:1 1 60px; }
      .word-meaning { flex:1 1 100px; }
    }
  </style>
</head>
<body>
  <header><h1>日英雙語互動學習</h1></header>
  <div id="langSwitch">
    <button id="btnJP" class="active">日文50音</button>
    <button id="btnEN">英文單字</button>
  </div>

  <!-- Japanese Section -->
  <section id="jpSection" class="active">
    <div class="controls">
      <button id="btnBasic">基本50音</button>
      <button id="btnDakuten">濁音</button>
      <button id="btnHandakuten">半濁音</button>
      <button id="btnReview">50音複習</button>
    </div>
    <div class="card" id="jpQuiz"></div>
  </section>

  <!-- English Section -->
  <section id="enSection">
    <div class="card" id="enQuiz">Loading…</div>
  </section>

  <script>
  // Language switch
  document.getElementById('btnJP').onclick = ()=>{
    document.getElementById('jpSection').classList.add('active');
    document.getElementById('enSection').classList.remove('active');
    document.getElementById('btnJP').classList.add('active');
    document.getElementById('btnEN').classList.remove('active');
  };
  document.getElementById('btnEN').onclick = ()=>{
    document.getElementById('enSection').classList.add('active');
    document.getElementById('jpSection').classList.remove('active');
    document.getElementById('btnEN').classList.add('active');
    document.getElementById('btnJP').classList.remove('active');
    loadVocab();
  };

  // -------- Japanese Quiz Code --------
  const basicData = [
    {kana:'あ',answer:'a'},{kana:'い',answer:'i'},{kana:'う',answer:'u'},{kana:'え',answer:'e'},{kana:'お',answer:'o'},
    {kana:'か',answer:'ka'},{kana:'き',answer:'ki'},{kana:'く',answer:'ku'},{kana:'け',answer:'ke'},{kana:'こ',answer:'ko'},
    {kana:'さ',answer:'sa'},{kana:'し',answer:'shi'},{kana:'す',answer:'su'},{kana:'せ',answer:'se'},{kana:'そ',answer:'so'},
    {kana:'た',answer:'ta'},{kana:'ち',answer:'chi'},{kana:'つ',answer:'tsu'},{kana:'て',answer:'te'},{kana:'と',answer:'to'},
    {kana:'な',answer:'na'},{kana:'に',answer:'ni'},{kana:'ぬ',answer:'nu'},{kana:'ね',answer:'ne'},{kana:'の',answer:'no'},
    {kana:'は',answer:'ha'},{kana:'ひ',answer:'hi'},{kana:'ふ',answer:'fu'},{kana:'へ',answer:'he'},{kana:'ほ',answer:'ho'},
    {kana:'ま',answer:'ma'},{kana:'み',answer:'mi'},{kana:'む',answer:'mu'},{kana:'め',answer:'me'},{kana:'も',answer:'mo'},
    {kana:'や',answer:'ya'},{kana:'ゆ',answer:'yu'},{kana:'よ',answer:'yo'},{kana:'ら',answer:'ra'},{kana:'り',answer:'ri'},
    {kana:'る',answer:'ru'},{kana:'れ',answer:'re'},{kana:'ろ',answer:'ro'},{kana:'わ',answer:'wa'},{kana:'を',answer:'wo'},{kana:'ん',answer:'n'}
  ];
  const dakutenData = [
    {kana:'が',answer:'ga'},{kana:'ぎ',answer:'gi'},{kana:'ぐ',answer:'gu'},{kana:'げ',answer:'ge'},{kana:'ご',answer:'go'},
    {kana:'ざ',answer:'za'},{kana:'じ',answer:'ji'},{kana:'ず',answer:'zu'},{kana:'ぜ',answer:'ze'},{kana:'ぞ',answer:'zo'},
    {kana:'だ',answer:'da'},{kana:'ぢ',answer:'ji'},{kana:'づ',answer:'zu'},{kana:'で',answer:'de'},{kana:'ど',answer:'do'},
    {kana:'ば',answer:'ba'},{kana:'び',answer:'bi'},{kana:'ぶ',answer:'bu'},{kana:'べ',answer:'be'},{kana:'ぼ',answer:'bo'}
  ];
  const handakutenData = [
    {kana:'ぱ',answer:'pa'},{kana:'ぴ',answer:'pi'},{kana:'ぷ',answer:'pu'},{kana:'ぺ',answer:'pe'},{kana:'ぽ',answer:'po'}
  ];
  let jpData = basicData, jpWrong = [], jpCount = 0;
  const perRow = 10;
  function shuffle(a){ return a.map(v=>({v,sort:Math.random()})).sort((a,b)=>a.sort-b.sort).map(e=>e.v); }
  function startJP(ds){ jpData = ds; jpWrong = []; jpCount = 0; document.getElementById('jpQuiz').innerHTML = ''; addJPRound(); }
  function addJPRound(){
    const div = document.getElementById('jpQuiz');
    let arr = shuffle(jpData);
    if(jpWrong.length) arr = arr.concat(jpWrong);
    let wrong = [];
    arr.forEach(it=>{
      jpCount++;
      if((jpCount-1)%perRow===0){
        const row = document.createElement('div'); row.className='row'; div.appendChild(row);
      }
      const row = div.lastElementChild;
      const q = document.createElement('div'); q.className='question';
      q.innerHTML = `<label>${jpCount}. ${it.kana}</label><input id="jpa${jpCount}" /><span class="feedback" id="jpf${jpCount}"></span>`;
      row.appendChild(q);
      const inp = q.querySelector('input'), fb = q.querySelector('.feedback');
      function chk(){ const v = inp.value.trim().toLowerCase(); 
        if(v===it.answer){ fb.textContent='✔'; fb.className='feedback correct'; }
        else{ fb.textContent=`✘ ${it.answer}`; fb.className='feedback incorrect'; wrong.push(it); }
      }
      function nxt(){ const nx = document.getElementById('jpa'+(jpCount+1));
        if(nx) nx.focus(); else { jpWrong = wrong; setTimeout(addJPRound,400); }
      }
      inp.addEventListener('change',()=>{chk(); nxt();});
      inp.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); chk(); nxt(); }} );
    });
    setTimeout(()=>{
      const first = document.getElementById('jpa'+(jpCount - arr.length +1));
      if(first) first.focus();
    },50);
  }
  function showJPReview(){
    const div = document.getElementById('jpQuiz');
    let html = '<div class="card"><table style="border-collapse:collapse;margin:auto;">';
    basicData.forEach(it=>{
      html += `<tr><td style="border:1px solid #ccc;padding:4px;">${it.kana}</td><td style="border:1px solid #ccc;padding:4px;">${it.answer}</td></tr>`;
    });
    html += '</table></div>';
    div.innerHTML = html;
  }
  document.getElementById('btnBasic').onclick=()=>startJP(basicData);
  document.getElementById('btnDakuten').onclick=()=>startJP(dakutenData);
  document.getElementById('btnHandakuten').onclick=()=>startJP(handakutenData);
  document.getElementById('btnReview').onclick=showJPReview;
  window.onload = ()=>startJP(basicData);

  // -------- English Quiz Code --------
  async function loadVocab(){
    const res = await fetch('words_10000.json');
    vocab = await res.json();
    renderEN();
  }
  let vocab = [];
  function shuffleV(a){ return a.map(v=>({v,sort:Math.random()})).sort((a,b)=>a.sort-b.sort).map(e=>e.v); }
  function renderEN(){
    const num = 20;
    const list = shuffleV(vocab).slice(0,num);
    let html = '';
    list.forEach((it,i)=>{
      const w = encodeURIComponent(it.word);
      const syns = it.syns||[];
      html += `<div class="word-item">
        <span class="word-index">${i+1}.</span>
        <span class="word-meaning">${it.meaning}</span>
        <input id="ena${i}" class="ans-input" data-ans="${it.word.toLowerCase()}" data-syns="${syns.join(',').toLowerCase()}" />
        <span id="enf${i}" class="ans-feedback"></span>
        <span class="word-src">[${it.src}]</span>
        <span class="word-link">
          <a href="https://dictionary.cambridge.org/dictionary/english/${w}" target="_blank">Cambridge</a>
          <a href="https://www.urbandictionary.com/define.php?term=${w}" target="_blank">Urban</a>
        </span>
      </div>`;
    });
    html += `<button onclick="checkEN(${num})">提交</button>
             <button onclick="renderEN()" style="background:#666;margin-top:6px;">再產生</button>`;
    document.getElementById('enQuiz').innerHTML = html;
    document.getElementById('ena0').focus();
  }
  function checkEN(n){
    for(let i=0;i<n;i++){
      const inp = document.getElementById('ena'+i), fb = document.getElementById('enf'+i);
      const ans = inp.dataset.ans, syns = inp.dataset.syns.split(',').filter(Boolean);
      const v = inp.value.trim().toLowerCase();
      let msg = '';
      if(v===ans||syns.includes(v)){
        msg = '✔';
        if(v!==ans) msg += '(同義詞)';
        if(syns.length) msg += `<span class="syns">同: ${[ans,...syns].join(', ')}</span>`;
        fb.className = 'ans-feedback correct';
      } else {
        msg = `✘ ${ans}`;
        if(syns.length) msg += `<span class="syns">同: ${[ans,...syns].join(', ')}</span>`;
        fb.className = 'ans-feedback incorrect';
      }
      fb.innerHTML = msg;
      inp.disabled = true;
    }
  }
  </script>
</body>
</html>
